@using Luftfartshinder.Models.Domain
@model Obstacle
@{
	ViewData["Title"] = "Home Page";
}

@section Styles {
	<link rel="stylesheet" href="~/css/index.css" />
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
	<link href="~/css/geolet.css" rel="stylesheet" />
}

<div id="map"></div>

<div class="wheel hidden">
	<div class="arc" data-type="point"><i class="fa-solid fa-genderless"></i></div>
	<div class="arc" data-type="mast"><i class="material-symbols-outlined">adjust</i></div>
	<div class="arc" data-type="line"><i class="material-symbols-outlined">show_chart</i></div>
	<div class="arc" data-type="powerline"><i class="material-symbols-outlined">diagonal_line</i></div>
	<div class="arc" data-type="area"><i class="material-symbols-outlined">crop_square</i></div>
</div>


<div class="modal fade" id="tutorialModal" tabindex="-1" aria-labelledby="tutorialModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header text-white" style="background-color: #34656D;">
                <h5 class="modal-title" id="tutorialModalLabel" style="font-size: 1.3rem;">
                    <i class="fas fa-info-circle me-2"></i>
                    How to Report an Obstacle
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" style="padding: 1.5rem; font-size: 1rem; max-height: 70vh; overflow-y: auto;">
				<div class="mb-3">
					<h6 class="fw-bold mb-2" style="font-size: 1.1rem;">Step 1: Navigate to Your Current Location</h6>
					<p class="mb-2" style="font-size: 1rem;">To navigate to your current location on the map, click on the location button:</p>
					<div class="text-center mb-2">
						<img src="~/images/Lokasjon.png" alt="Location button" style="max-width: 80px;" />
					</div>
					<p class="mb-0 text-muted" style="font-size: 0.9rem;"><strong>This button</strong> will center the map on your current location when clicked.</p>
				</div>

				<div class="mb-3">
					<h6 class="fw-bold mb-2" style="font-size: 1.1rem;">Step 2: Click on the Map</h6>
					<p class="mb-0" style="font-size: 1rem;">Click anywhere on the map where you want to report an obstacle.</p>
				</div>

				<div class="mb-3">
					<h6 class="fw-bold mb-2" style="font-size: 1.1rem;">Step 3: Select Obstacle Type</h6>
					<p class="mb-2" style="font-size: 1rem;">A selection wheel will appear in the center of your screen with 5 options:</p>
					<ul class="list-unstyled ms-3" style="font-size: 1rem;">
						<li class="mb-2"><i class="fas fa-bullseye me-2" style="color: #000000;"></i><strong>Point</strong> - For point obstacles</li>
						<li class="mb-2"><i class="fas fa-circle me-2" style="color: #000000;"></i><strong>Mast</strong> - For mast or pole structures</li>
						<li class="mb-2"><span class="material-symbols-outlined" style="color: #000000; margin-right: 0.5rem; vertical-align: middle;">show_chart</span><strong>Line</strong> - For linear obstacles</li>
						<li class="mb-2"><span class="material-symbols-outlined" style="color: #000000; margin-right: 0.5rem; vertical-align: middle;">diagonal_line</span><strong>Power Line</strong> - For power lines or cables</li>
						<li class="mb-2"><i class="fas fa-square me-2" style="color: #000000;"></i><strong>Area</strong> - For area obstacles</li>
					</ul>
				</div>

				<div class="mb-2">
					<h6 class="fw-bold mb-2" style="font-size: 1.1rem;">Step 4: Complete the Form</h6>
					<p class="mb-0" style="font-size: 1rem;">After selecting a type, fill in the obstacle details and submit your report.</p>
				</div>
			</div>
			<div class="modal-footer" style="padding: 1rem 1.5rem;">
				<button type="button" class="btn text-white" data-bs-dismiss="modal" style="background-color: #0d6efd; font-size: 1rem; padding: 0.6rem 1.5rem; min-height: 44px;">Skip</button>
			</div>
		</div>
	</div>
</div>

<div class="toast-container position-fixed end-0 p-3" style="z-index: 3000; top: 5vh;">
	<div id="toastObstacleAdded" class="toast text-white bg-success border-0" role="alert">
		<div class="toast-body">
			Obstacle added to draft!
		</div>
	</div>
</div>

<div class="toast-container position-fixed end-0 p-3" style="z-index: 3000; top: 5vh;">
	<div id="toastDraftSubmitted" class="toast text-white bg-success border-0" role="alert">
		<div class="toast-body">
			Draft submitted!
		</div>
	</div>
</div>

<form method="post">
	@Html.AntiForgeryToken()
	<div>
		<input type="hidden" asp-for="Longitude" id="longitude" />
		<input type="hidden" asp-for="Latitude" id="latitude" />
	</div>

	<div>
		<input type="hidden" asp-for="Type" id="obstacletype" />
	</div>
</form>

<form id="antiForgeryForm" class="hidden">
	@Html.AntiForgeryToken()
</form>

@section Scripts {
	<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
	<script src="~/js/geolet.js"></script>
	<script src="~/js/map.js" defer></script>
	<script>
		function showTutorialModal() {
			const tutorialModal = new bootstrap.Modal(document.getElementById('tutorialModal'));
			tutorialModal.show();
		}

		document.addEventListener('DOMContentLoaded', function() {
			const tutorialShown = sessionStorage.getItem('tutorialShown');
			if (!tutorialShown) {
				showTutorialModal();
				sessionStorage.setItem('tutorialShown', 'true');
			}

			const tutorialNavButton = document.getElementById('tutorialNavButton');
			if (tutorialNavButton) {
				tutorialNavButton.addEventListener('click', function(e) {
					e.preventDefault();
					showTutorialModal();
				});
			}

			const tutorialNavButtonIPad = document.getElementById('tutorialNavButtonIPad');
			if (tutorialNavButtonIPad) {
				tutorialNavButtonIPad.addEventListener('click', function(e) {
					e.preventDefault();
					const offcanvas = bootstrap.Offcanvas.getInstance(document.getElementById('offcanvasNavbar'));
					if (offcanvas) {
						offcanvas.hide();
					}
					showTutorialModal();
				});
			}
		});

		document.addEventListener("DOMContentLoaded", function () {
			const submitted = '@TempData["DraftSubmitted"]';
			if (submitted === 'True') {
				const toastEl = document.getElementById('toastDraftSubmitted');
				const toast = new bootstrap.Toast(toastEl, { delay: 3000 });
				toast.show();
			}
		});

		document.addEventListener("DOMContentLoaded", function () {
			const submitted = '@TempData["DraftCleared"]';
			if (submitted === 'True') {
				const toastEl = document.getElementById('toastDraftCleared');
				const toast = new bootstrap.Toast(toastEl, { delay: 3000 });
				toast.show();
			}
		});
	</script>
}