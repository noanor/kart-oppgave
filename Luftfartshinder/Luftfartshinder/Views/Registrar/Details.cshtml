@model Luftfartshinder.Controllers.RegistrarDetails
@{
    ViewData["Title"] = "Registrar – Details";
}

<div class="mb-3">
    <a href="@Url.Action("Index", "Registrar")" class="back-link d-inline-flex align-items-center text-decoration-none">
        <span class="me-2 fs-5">←</span>
        <span class="fw-semibold">Back to List</span>
    </a>
</div>

<div class="card shadow-sm mt-3">
    <div class="card-body p-4">
        <h3 class="card-title mb-4">@(!string.IsNullOrWhiteSpace(Model.Name) ? Model.Name : "Obstacle")</h3>

        <dl class="row g-3">
            <dt class="col-sm-3">Id</dt>
            <dd class="col-sm-9">@Model.Id</dd>

            <dt class="col-sm-3">Actions</dt>
            <dd class="col-sm-9">
                @if (Model.Id >= 0)
                {
                    <div class="d-flex align-items-center gap-2 flex-wrap">
                        <form asp-controller="Registrar" asp-action="Approve" method="post" class="d-inline">
                            <input type="hidden" name="id" value="@Model.Id" />
                            <button type="submit" class="btn btn-success btn-sm px-4 py-2">Approve</button>
                        </form>
                        <form asp-controller="Registrar" asp-action="Reject" method="post" class="d-inline">
                            <input type="hidden" name="id" value="@Model.Id" />
                            <button type="submit" class="btn btn-danger btn-sm px-4 py-2">Reject</button>
                        </form>
                    </div>
                }
            </dd>

            <dt class="col-sm-3">Status</dt>
            <dd class="col-sm-9">
                @switch (Model.Status)
                {
                    case Luftfartshinder.Controllers.ReviewStatus.Approved:
                        <span class="badge rounded-pill bg-success px-3 py-2">Approved</span>
                        break;
                    case Luftfartshinder.Controllers.ReviewStatus.Rejected:
                        <span class="badge rounded-pill bg-danger px-3 py-2">Rejected</span>
                        break;
                    default:
                        <span class="badge rounded-pill bg-warning text-dark px-3 py-2">Pending</span>
                        break;
                }
            </dd>

            <dt class="col-sm-3">Coordinates</dt>
            <dd class="col-sm-9">@Model.Latitude.ToString("0.000000"), @Model.Longitude.ToString("0.000000")</dd>

            <dt class="col-sm-3">Height</dt>
            <dd class="col-sm-9">@((Model.Height?.ToString()) ?? "-")</dd>

            <dt class="col-sm-3">Reporter</dt>
            <dd class="col-sm-9">@(!string.IsNullOrWhiteSpace(Model.Reporter) ? Model.Reporter : "-")</dd>

            <dt class="col-sm-3">Date</dt>
            <dd class="col-sm-9">
                @(Model.CreatedAt.HasValue
                                ? Model.CreatedAt.Value.ToLocalTime().ToString("yyyy-MM-dd")
                                : "-")
            </dd>

            <dt class="col-sm-3">Registrar Note</dt>
            <dd class="col-sm-9">
                @{
                    var noteSaved = TempData["NoteSaved"] != null; 
                }
                <form asp-controller="Registrar" asp-action="SaveNote" method="post" class="row g-2">
                    <input type="hidden" name="id" value="@Model.Id" />

                 
                    <div class="col-12">
                        <textarea name="note" class="form-control" rows="4"
                                  placeholder="Ask for more info, add internal remarks, etc.">@Model.Note</textarea>
                    </div>

                    <!-- Button + Saved indicator (stays visible) -->
                    <div class="col-12 d-flex align-items-center gap-3">
                        <button type="submit" class="btn btn-primary btn-sm px-4 py-2" id="saveNoteBtn">Save note</button>

                        <span id="noteSavedMsg"
                              class="fw-semibold text-dark @(noteSaved ? "" : "d-none")">
                            ✓ Saved
                        </span>
                    </div>
                </form>
            </dd>

            <dt class="col-sm-3">Description</dt>
            <dd class="col-sm-9">@(!string.IsNullOrWhiteSpace(Model.Description) ? Model.Description : "-")</dd>

            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    const saveBtn = document.getElementById("saveNoteBtn");
                    const savedMsg = document.getElementById("noteSavedMsg");
                    if (!saveBtn || !savedMsg) return;

                    saveBtn.addEventListener("click", function () {
                        savedMsg.classList.remove("d-none");
                    });
                });
            </script>

        </dl>
    </div>
</div>

